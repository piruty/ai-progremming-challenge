# jsonify - Makefile
# JSON formatter and validator CLI tool

# å¤‰æ•°å®šç¾©
APP_NAME = jsonify
GO_FILES = $(shell find . -name "*.go" -type f -not -path "./vendor/*")
MODULE_NAME = jsonify

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
.DEFAULT_GOAL := help

# ãƒã‚¤ãƒŠãƒªãƒ“ãƒ«ãƒ‰
.PHONY: build
build: ## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
	@echo "ğŸ”¨ Building $(APP_NAME)..."
	go build -o $(APP_NAME) .
	@echo "âœ… Build completed: $(APP_NAME)"

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
.PHONY: test
test: ## å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
	@echo "ğŸ§ª Running tests..."
	go test ./cmd/... -v
	@echo "âœ… Tests completed"

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
.PHONY: test-coverage
test-coverage: ## ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤º
	@echo "ğŸ“Š Running tests with coverage..."
	go test ./cmd/... -cover -v
	@echo "âœ… Coverage analysis completed"

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è©³ç´°ï¼ˆHTMLãƒ¬ãƒãƒ¼ãƒˆï¼‰
.PHONY: test-coverage-html
test-coverage-html: ## HTMLã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
	@echo "ğŸ“Š Generating HTML coverage report..."
	go test ./cmd/... -coverprofile=coverage.out
	go tool cover -html=coverage.out -o coverage.html
	@echo "âœ… HTML coverage report generated: coverage.html"

# Goå®Ÿè¡Œï¼ˆdevelopmentãƒ¢ãƒ¼ãƒ‰ï¼‰
.PHONY: run
run: ## go runã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè¡Œï¼ˆå¼•æ•°: ARGSï¼‰
	@echo "ğŸš€ Running with go run..."
	go run . $(ARGS)

# ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œ
.PHONY: run-examples
run-examples: build ## ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã®å‹•ä½œã‚’ç¢ºèª
	@echo "ğŸ¯ Running examples..."
	@echo "--- JSON Formatting ---"
	./$(APP_NAME) format -f examples/sample.json -s
	@echo
	@echo "--- JSON Validation ---"
	./$(APP_NAME) validate -f examples/sample.json
	./$(APP_NAME) validate -f examples/invalid.json
	@echo
	@echo "--- Schema Validation ---"
	./$(APP_NAME) schema -f examples/sample.json -s examples/person-schema.json
	@echo "âœ… Examples completed"

# ä¾å­˜é–¢ä¿‚ã®æ•´ç†
.PHONY: tidy
tidy: ## go.modãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’æ•´ç†
	@echo "ğŸ§¹ Tidying dependencies..."
	go mod tidy
	@echo "âœ… Dependencies tidied"

# ãƒ™ãƒ³ãƒ€ãƒªãƒ³ã‚°
.PHONY: vendor
vendor: ## ä¾å­˜é–¢ä¿‚ã‚’vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
	@echo "ğŸ“¦ Downloading vendor dependencies..."
	go mod vendor
	@echo "âœ… Vendor dependencies downloaded"

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
.PHONY: clean
clean: ## ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’å‰Šé™¤
	@echo "ğŸ§¹ Cleaning up..."
	rm -f $(APP_NAME)
	rm -f coverage.out
	rm -f coverage.html
	rm -rf vendor/
	@echo "âœ… Cleanup completed"

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
.PHONY: install
install: ## ãƒã‚¤ãƒŠãƒªã‚’$GOPATH/binã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	@echo "ğŸ’¿ Installing $(APP_NAME)..."
	go install .
	@echo "âœ… $(APP_NAME) installed to $GOPATH/bin"

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
.PHONY: fmt
fmt: ## ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œ
	@echo "ğŸ¨ Formatting code..."
	go fmt ./...
	@echo "âœ… Code formatted"

# Lint
.PHONY: lint
lint: ## golangci-lintã‚’å®Ÿè¡Œï¼ˆgolangci-lintãŒå¿…è¦ï¼‰
	@echo "ğŸ” Running linter..."
	@if command -v golangci-lint >/dev/null 2>&1; then \
		golangci-lint run; \
		echo "âœ… Linting completed"; \
	else \
		echo "âš ï¸  golangci-lint not found. Install it with: go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"; \
	fi

# ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
.PHONY: bench
bench: ## ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
	@echo "âš¡ Running benchmarks..."
	go test -bench=. -benchmem ./cmd/...
	@echo "âœ… Benchmarks completed"

# å…¨ä½“ãƒã‚§ãƒƒã‚¯
.PHONY: check
check: fmt lint test ## ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€Lintã€ãƒ†ã‚¹ãƒˆã‚’é †æ¬¡å®Ÿè¡Œ
	@echo "âœ… All checks passed"

# é–‹ç™ºç”¨ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒ“ãƒ«ãƒ‰
.PHONY: dev
dev: ## é–‹ç™ºç”¨ï¼šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ãƒ“ãƒ«ãƒ‰ã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
	@echo "ğŸš€ Development build..."
	$(MAKE) fmt
	$(MAKE) build
	$(MAKE) test
	@echo "âœ… Development build completed"

# ãƒªãƒªãƒ¼ã‚¹ç”¨ã®ãƒ“ãƒ«ãƒ‰
.PHONY: release
release: ## ãƒªãƒªãƒ¼ã‚¹ç”¨ï¼šå…¨ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ãƒ“ãƒ«ãƒ‰
	@echo "ğŸš€ Release build..."
	$(MAKE) clean
	$(MAKE) check
	$(MAKE) build
	@echo "âœ… Release build completed"

# ãƒ˜ãƒ«ãƒ—
.PHONY: help
help: ## ã“ã®ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
	@echo "jsonify - JSON formatter and validator"
	@echo ""
	@echo "Usage: make [target]"
	@echo ""
	@echo "Targets:"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "Examples:"
	@echo "  make build                 # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰"
	@echo "  make test                  # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
	@echo "  make run ARGS='--help'     # ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"
	@echo "  make run ARGS='format -f examples/sample.json -s'  # ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ•´å½¢"
	@echo "  make run-examples          # å…¨ã¦ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œ" 